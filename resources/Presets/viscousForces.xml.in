<?xml version="1.0" ?>

<!-- forces.xml
Viscous forces and moments runtime processor.

To use it, just include this file, and later set the initial values for the
variables:
viscousForces_iset = Particles set index affected where the forces should be
                      computed.
viscousForces_r    = Position of the center of rotation.

This preset is generating the following variables which are the global forces
and moments with respect to viscousForces_r:
viscousForces_F = Fluid forces
viscousForces_M = Fluid moments

This preset works just with boundary integrals boundary conditions. If you want
to get the forces on several bodies this preset can be included several times
using different prefixes, for instance in 3D (for 2D viscousForces_F
duplication must be conveniently modified):

<Include file="viscousForces.xml" prefix="iset0_"/>
<Include file="viscousForces.xml" prefix="iset2_"/>
<Variables>
    <Variable name="viscousForces_F_0" type="vec" value="0.0, 0.0, 0.0, 0.0" />
    <Variable name="viscousForces_M_0" type="vec4" value="0.0, 0.0, 0.0, 0.0" />
    <Variable name="viscousForces_F_2" type="vec" value="0.0, 0.0, 0.0, 0.0" />
    <Variable name="viscousForces_M_2" type="vec4" value="0.0, 0.0, 0.0, 0.0" />
</Variables>
<Tools>
    <Tool action="insert" before="iset0_ViscousForces" type="set_scalar" name="viscousForces_iset0" in="viscousForces_iset" value="0"/>
    <Tool action="insert" after="iset0_TotalPressureMoment" type="set_scalar" name="viscousForces_F_0" in="viscousForces_F_0" value="viscousForces_F_x, viscousForces_F_y, viscousForces_F_z, viscousForces_F_w"/>
    <Tool action="insert" after="iset0_TotalPressureForce" type="set_scalar" name="viscousForces_M_0" in="viscousForces_M_0" value="viscousForces_M_x, viscousForces_M_y, viscousForces_M_z, viscousForces_M_w"/>
    <Tool action="insert" before="iset2_ViscousForces" type="set_scalar" name="viscousForces_iset2" in="viscousForces_iset" value="2"/>
    <Tool action="insert" after="iset2_TotalPressureForce" type="set_scalar" name="viscousForces_F_2" in="viscousForces_F_2" value="viscousForces_F_x, viscousForces_F_y, viscousForces_F_z, viscousForces_F_w"/>
    <Tool action="insert" after="iset2_TotalPressureMoment" type="set_scalar" name="viscousForces_M_2" in="viscousForces_M_2" value="viscousForces_M_x, viscousForces_M_y, viscousForces_M_z, viscousForces_M_w"/>
</Tools>

The viscous forces are computing without caring about free-slip/no-slip boundary
conditions has been set, the user is responsible of checking the consistency.

If you wish to compute the global force for confined flows maybe you prefer to
use forces.xml
-->

<sphInput>
    <Variables>
        <!-- Particles set affected -->
        <Variable name="viscousForces_iset" type="unsigned int" value="0" />
        <!-- center of reference for the forces -->
        <Variable name="viscousForces_r" type="vec" value="0.0, 0.0, 0.0, 0.0" />
        <!-- Computed forces and moments for each boundary element -->
        <Variable name="viscousForces_f" type="vec*" length="N" />
        <Variable name="viscousForces_m" type="vec4*" length="N" />
        <!-- Computed global forces and moments for the fluid -->
        <Variable name="viscousForces_F" type="vec" value="0.0, 0.0, 0.0, 0.0" />
        <Variable name="viscousForces_M" type="vec4" value="0.0, 0.0, 0.0, 0.0" />
    </Variables>

    <Tools>
        <Tool action="try_insert" after="BI Shepard" type="kernel" name="BI viscous forces" path="@RESOURCES_OUTPUT_DIR@/OpenCL/Forces/BI/ViscousForces.cl"/>
        <Tool action="try_insert" after="GP LapU" type="kernel" name="GP viscous forces" path="@RESOURCES_OUTPUT_DIR@/OpenCL/Forces/GP/ViscousForces.cl"/>
        <Tool action="insert" after="Rates" type="reduction" name="Total viscous force" in="viscousForces_f" out="viscousForces_F" null="VEC_ZERO">
            c = a + b;
        </Tool>
        <Tool action="insert" after_prefix="Total viscous force" type="reduction" name="Total viscous moment" in="viscousForces_m" out="viscousForces_M" null="(vec4)(0.f, 0.f, 0.f, 0.f)">
            c = a + b;
        </Tool>
    </Tools>
</sphInput>
