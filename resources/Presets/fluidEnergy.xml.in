<?xml version="1.0" ?>

<!-- fluidEnergy.xml
Energy components computation, restricted to the effects of the interactions
between fluid particles.

To use this preset you just need to include this file.

Actually this preset only provide the power terms, without integrating them on
time.
-->

<sphInput>
    <Variables>
        <!-- Kinetic energy -->
        <Variable name="fluid_energy_dekindt" type="float*" length="N" />
        <Variable name="fluid_energy_dEkindt" type="float" value="0.0" />
        <!-- Potential energy -->
        <Variable name="fluid_energy_depotdt" type="float*" length="N" />
        <Variable name="fluid_energy_dEpotdt" type="float" value="0.0" />
        <!-- Compressibility energy -->
        <Variable name="fluid_energy_decomdt" type="float*" length="N" />
        <Variable name="fluid_energy_dEcomdt" type="float" value="0.0" />
        <!-- Internal energy -->
        <Variable name="fluid_energy_dEintdt" type="float" value="0.0" />
        <!-- Entropy -->
        <Variable name="fluid_energy_dSdt" type="float" value="0.0" />
    </Variables>

    <Tools>
        <!-- Compute the energy variations per particle -->
        <Tool action="insert" after="Interactions" type="kernel" name="Fluid Energy Rates" path="@RESOURCES_OUTPUT_DIR@/OpenCL/Rates.cl"/>
        <Tool action="insert" after="Fluid Energy Rates" type="kernel" name="Fluid Energy" path="@RESOURCES_OUTPUT_DIR@/OpenCL/Energy/FluidEnergy.cl"/>
        <!-- Integrate them to the global energy components variation -->
        <Tool action="insert" after="Energy" type="reduction" name="dEkindt" in="fluid_energy_dekindt" out="fluid_energy_dEkindt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEkindt" type="reduction" name="dEpotdt" in="fluid_energy_depotdt" out="fluid_energy_dEpotdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEpotdt" type="reduction" name="dEcomdt" in="fluid_energy_decomdt" out="fluid_energy_dEcomdt" null="0.f">
            c = a + b;
        </Tool>
        <!-- Deduce the internal energy and entropy -->
        <Tool action="insert" after="dEcomdt" type="set_scalar" name="dEintdt" in="energy_dEintdt" value="-fluid_energy_dEkindt - fluid_energy_dEpotdt"/>
        <Tool action="insert" after="dEintdt" type="set_scalar" name="dSdt" in="energy_dSdt" value="fluid_energy_dEintdt - fluid_energy_dEcomdt"/>
    </Tools>
</sphInput>
