<?xml version="1.0" ?>

<!-- forces.xml
Pressure forces and moments runtime processor.

To use it, just include this file, and later set the initial values for the
variables:
pressureForces_iset = Particles set index affected where the forces should be
                      computed.
pressureForces_r    = Position of the center of rotation.

This preset is generating the following variables which are the global forces
and moments with respect to pressureForces_r:
pressureForces_F = Fluid forces
pressureForces_M = Fluid moments

This preset works just with boundary integrals boundary conditions. If you want
to get the forces on several bodies this preset can be included several times
using different prefixes, for instance in 3D (for 2D pressureForces_F
duplication must be conveniently modified):

<Include file="pressureForces.xml" prefix="iset0_"/>
<Include file="pressureForces.xml" prefix="iset2_"/>
<Variables>
    <Variable name="pressureForces_F_0" type="vec" value="0.0, 0.0, 0.0, 0.0" />
    <Variable name="pressureForces_M_0" type="vec4" value="0.0, 0.0, 0.0, 0.0" />
    <Variable name="pressureForces_F_2" type="vec" value="0.0, 0.0, 0.0, 0.0" />
    <Variable name="pressureForces_M_2" type="vec4" value="0.0, 0.0, 0.0, 0.0" />
</Variables>
<Tools>
    <Tool action="insert" before="iset0_PressureForces" type="set_scalar" name="pressureForces_iset0" in="pressureForces_iset" value="0"/>
    <Tool action="insert" after="iset0_TotalPressureMoment" type="set_scalar" name="pressureForces_F_0" in="pressureForces_F_0" value="pressureForces_F_x, pressureForces_F_y, pressureForces_F_z, pressureForces_F_w"/>
    <Tool action="insert" after="iset0_TotalPressureForce" type="set_scalar" name="pressureForces_M_0" in="pressureForces_M_0" value="pressureForces_M_x, pressureForces_M_y, pressureForces_M_z, pressureForces_M_w"/>
    <Tool action="insert" before="iset2_PressureForces" type="set_scalar" name="pressureForces_iset2" in="pressureForces_iset" value="2"/>
    <Tool action="insert" after="iset2_TotalPressureForce" type="set_scalar" name="pressureForces_F_2" in="pressureForces_F_2" value="pressureForces_F_x, pressureForces_F_y, pressureForces_F_z, pressureForces_F_w"/>
    <Tool action="insert" after="iset2_TotalPressureMoment" type="set_scalar" name="pressureForces_M_2" in="pressureForces_M_2" value="pressureForces_M_x, pressureForces_M_y, pressureForces_M_z, pressureForces_M_w"/>
</Tools>

If you wish to compute the global force for confined flows maybe you prefer to
use forces.xml
-->

<sphInput>
    <Variables>
        <!-- Particles set affected -->
        <Variable name="pressureForces_iset" type="unsigned int" value="0" />
        <!-- center of reference for the forces -->
        <Variable name="pressureForces_r" type="vec" value="0.0, 0.0, 0.0, 0.0" />
        <!-- Computed forces and moments for each boundary element -->
        <Variable name="pressureForces_f" type="vec*" length="N" />
        <Variable name="pressureForces_m" type="vec4*" length="N" />
        <!-- Computed global forces and moments for the fluid -->
        <Variable name="pressureForces_F" type="vec" value="0.0, 0.0, 0.0, 0.0" />
        <Variable name="pressureForces_M" type="vec4" value="0.0, 0.0, 0.0, 0.0" />
    </Variables>

    <Tools>
        <Tool action="insert" before="Rates" type="kernel" name="PressureForces" path="@RESOURCES_OUTPUT_DIR@/OpenCL/PressureForces.cl"/>
        <Tool action="insert" after_prefix="PressureForces" type="reduction" name="TotalPressureForce" in="pressureForces_f" out="pressureForces_F" null="VEC_ZERO">
            c = a + b;
        </Tool>
        <Tool action="insert" after_prefix="TotalPressureForce" type="reduction" name="TotalPressureMoment" in="pressureForces_m" out="pressureForces_M" null="(vec4)(0.f, 0.f, 0.f, 0.f)">
            c = a + b;
        </Tool>
    </Tools>
</sphInput>
