<?xml version="1.0" ?>

<!-- energy.xml
Energy components (due to the fluid particles interactions) computation.

This preset depends on energy.xml.
-->

<sphInput>
    <Variables>
        <!-- Internal energy -->
        <Variable name="energy_fluid_deintdt" type="float*" length="N" />
        <Variable name="energy_fluid_dEintdt" type="float" value="0.0" />
        <Variable name="energy_fluid_Eint" type="float" value="0.0" />
        <!-- Entropy -->
        <Variable name="energy_fluid_dsdt" type="float*" length="N" />
        <Variable name="energy_fluid_dSdt" type="float" value="0.0" />
        <Variable name="energy_fluid_S" type="float" value="0.0" />
        <!-- Kinetic energy -->
        <Variable name="energy_fluid_dekindt" type="float*" length="N" />
        <Variable name="energy_fluid_dEkindt" type="float" value="0.0" />
        <Variable name="energy_fluid_Ekin" type="float" value="0.0" />
        <!-- External gravity work (-variation fo the potential energy) -->
        <Variable name="energy_fluid_depotdt" type="float*" length="N" />
        <Variable name="energy_fluid_dEpotdt" type="float" value="0.0" />
        <Variable name="energy_fluid_Epot" type="float" value="0.0" />
        <!-- External pressure work -->        
        <Variable name="energy_fluid_dwdt" type="float*" length="N" />
        <Variable name="energy_fluid_dWdt" type="float" value="0.0" />
        <Variable name="energy_fluid_W" type="float" value="0.0" />
    </Variables>

    <Tools>
        <!-- Compute the energy variations per particle -->
        <Tool action="insert" before="NonFluidSet" type="kernel" name="Energy_fluid" path="@RESOURCES_OUTPUT_DIR@/OpenCL/Energy/Energy_fluid.cl"/>
        <!-- Integrate them to the global energy components variation -->
        <Tool action="insert" after="Energy_fluid" type="reduction" name="dEpotdt_fluid" in="energy_fluid_depotdt" out="energy_fluid_dEpotdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEpotdt_fluid" type="reduction" name="dWdt_fluid" in="energy_fluid_dwdt" out="energy_fluid_dWdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dWdt_fluid" type="reduction" name="dEkindt_fluid" in="energy_fluid_dekindt" out="energy_fluid_dEkindt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEkindt_fluid" type="reduction" name="dEintdt_fluid" in="energy_fluid_deintdt" out="energy_fluid_dEintdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEintdt_fluid" type="reduction" name="dSdt_fluid" in="energy_fluid_dsdt" out="energy_fluid_dSdt" null="0.f">
            c = a + b;
        </Tool>
        <!-- Integrate in time -->
        <Tool action="insert" after="dSdt_fluid" type="set_scalar" name="Epot_fluid" in="energy_fluid_Epot" value="energy_fluid_Epot + energy_fluid_dEpotdt * dt"/>
        <Tool action="insert" after="Epot_fluid" type="set_scalar" name="EW_fluid" in="energy_fluid_W" value="energy_fluid_W + energy_fluid_dWdt * dt"/>
        <Tool action="insert" after="EW_fluid" type="set_scalar" name="Ekin_fluid" in="energy_fluid_Ekin" value="energy_fluid_Ekin + energy_fluid_dEkindt * dt"/>
        <Tool action="insert" after="Ekin_fluid" type="set_scalar" name="Eint_fluid" in="energy_fluid_Eint" value="energy_fluid_Eint + energy_fluid_dEintdt * dt"/>
        <Tool action="insert" after="Eint_fluid" type="set_scalar" name="ES_fluid" in="energy_fluid_S" value="energy_fluid_S + energy_fluid_dSdt * dt"/>
    </Tools>
</sphInput>
