<?xml version="1.0" ?>

<!-- forces.xml
Forces and moments runtime processor.
This preset is designed to be loaded after cfd.xml.

To use it, just include this file, and later set the initial values for the
variables:
forces_r = Position of the center of rotation

This preset is generating the following variables which are the global forces
and moments with respect to motion_r:
forces_F = Fluid forces
forces_M = Fluid moments
-->

<sphInput>
    <Variables>
        <!-- Internal energy -->
        <Variable name="energy_dEintdt" type="float" value="0.0" />
        <Variable name="energy_Eint" type="float" value="0.0" />
        <!-- Entropy -->
        <Variable name="energy_dsdt" type="float*" length="N" />
        <Variable name="energy_dSdt" type="float" value="0.0" />
        <Variable name="energy_S" type="float" value="0.0" />
        <!-- Kinetic energy -->
        <Variable name="energy_dekindt" type="float*" length="N" />
        <Variable name="energy_dEkindt" type="float" value="0.0" />
        <Variable name="energy_Ekin" type="float" value="0.0" />
        <!-- External gravity work (-variation fo the potential energy) -->
        <Variable name="energy_depotdt" type="float*" length="N" />
        <Variable name="energy_dEpotdt" type="float" value="0.0" />
        <Variable name="energy_Epot" type="float" value="0.0" />
        <!-- External pressure work -->        
        <Variable name="energy_dwdt" type="float*" length="N" />
        <Variable name="energy_dWdt" type="float" value="0.0" />
        <Variable name="energy_W" type="float" value="0.0" />
    </Variables>

    <Tools>
        <!-- Compute the energy variations per particle -->
        <Tool action="insert" before="t = t + dt" type="kernel" name="Energy" path="@RESOURCES_OUTPUT_DIR@/OpenCL/Energy.cl"/>
        <!-- Integrate them to the global energy components variation -->
        <Tool action="insert" after="Energy" type="reduction" name="dSdt" in="energy_dsdt" out="energy_dSdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dSdt" type="reduction" name="dEkindt" in="energy_dekindt" out="energy_dEkindt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEkindt" type="reduction" name="dEpotdt" in="energy_depotdt" out="energy_dEpotdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dEpotdt" type="reduction" name="dWdt" in="energy_dwdt" out="energy_dWdt" null="0.f">
            c = a + b;
        </Tool>
        <Tool action="insert" after="dWdt" type="set_scalar" name="dEintdt" in="energy_dEintdt" value="energy_dWdt - energy_dEpotdt - energy_dEkindt"/>
        <!-- Integrate in time -->
        <Tool action="insert" after="dEintdt" type="set_scalar" name="Eint" in="energy_Eint" value="energy_Eint + energy_dEintdt * dt"/>
        <Tool action="insert" after="Eint" type="set_scalar" name="ES" in="energy_S" value="energy_S + energy_dSdt * dt"/>
        <Tool action="insert" after="ES" type="set_scalar" name="Ekin" in="energy_Ekin" value="energy_Ekin + energy_dEkindt * dt"/>
        <Tool action="insert" after="Ekin" type="set_scalar" name="Epot" in="energy_Epot" value="energy_Epot + energy_dEpotdt * dt"/>
        <Tool action="insert" after="Epot" type="set_scalar" name="EW" in="energy_W" value="energy_W + energy_dWdt * dt"/>
    </Tools>
</sphInput>
